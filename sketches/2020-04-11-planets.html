<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1 user-scalable=0">
    <style> body {padding: 0; margin: 0; overflow: hidden;} </style>
    <script src="./js/utils.js"></script>
    <script src="/node_modules/p5/lib/p5.min.js"></script>
    <script src="/node_modules/dat.gui/build/dat.gui.min.js"></script>
    <script>

// Options
let opts = {
  satellites: 10,
  size: 12,
  speed: 1,
  gravity: 0.001,
}

let palette = [
  '#62B1F7', // blue
  '#E8AB47', // yellow
  '#D84062', // red
  '#F6EEF1', // off white
]

let bgColor = '#101922';

// Globals
let satellites = [];

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}

function setup() {
  createCanvas(windowWidth, windowHeight);
  // colorMode(HSB);

  let gui = new dat.GUI();
  gui.add(opts, 'satellites', 0, 250)
  gui.add(opts, 'size', 1, 100)
  gui.add(opts, 'speed', 0, 10)
  gui.add(opts, 'gravity', 0, 5)
  
  // noLoop();
  // frameRate(2);

  // Colors
  fill('red')
  noStroke();
}

function draw() {
  background(bgColor);

  // Add or remove satellites as needed
  let diff = satellites.length - Math.floor(opts.satellites);
  if (diff > 0) {
    satellites.splice(satellites.length - diff - 1);
  } else if (diff < 0) {
    addSatellites(Math.abs(diff));
  }



  // Draw
  for (let i = 0; i < satellites.length; i++) {
    let satellite = satellites[i];
    satellite.update()
    satellite.draw();
  }
}




function calcAttraction(obj1, obj2) {
    let diff = P5.Vector.sub(obj1, obj2);

    let a = (opts.gravity * obj1.mass * obj2.mass) / diff.magSq();
    console.log(a);
    
    // (G * m1 * m2) / d2 * unit vector
}

class Satellite {
  constructor() {
    // random color
    this.color = random(palette);
    
    // random x, y
    this.pos = createVector(
      random(opts.size, windowWidth - opts.size),
      random(opts.size, windowHeight - opts.size)
    );

    // random velocity
    this.vel = p5.Vector.random2D();

    this.mass = 1;
    this.density = 1;
  }

  applyForce() {
    // Attraction


    // Drag?
  }

  update() {
    // move

    let vel = createVector(this.vel.x, this.vel.y).mult(opts.speed);
    this.pos.add(vel);

    // check boundaries
    let half = opts.size / 2;
    if (this.pos.x - half < 0) {
      this.vel.x = Math.abs(this.vel.x);
    } else if (this.pos.x + half > windowWidth) {
      this.vel.x = Math.abs(this.vel.x) * -1;
    } else if (this.pos.y - half < 0) {
      this.vel.y = Math.abs(this.vel.y);
    } else if (this.pos.y + half > windowHeight) {
      this.vel.y = Math.abs(this.vel.y) * -1;
    }
  }

  draw() {
    // draw circle
    fill(this.color);
    ellipse(this.pos.x, this.pos.y, opts.size);
  }
}

function addSatellites(num) {
  for (let i = 0; i < num; i++) {
    satellites.push(new Satellite());
  }
}

    </script>
  </head>
  <body>
  </body>
</html>
